---
typora-copy-images-to: images
---

## 数据链路层

a:数据链路层的功能

b:差错控制（检错编码、纠错编码）

c:流量控制、可靠传输与滑动窗口机制

d:停止－等待协议、后退N帧协议（GBN）、选择重传协议（SR）

e:介质访问控制（MAC）协议（信道划分、随机访问、轮询访问，无冲突协议）

f:局域网（以太网、IEEE802.11）

g:网桥、局域网交换机的概念及其基本原理

### 数据链路层的功能

为网络层提供服务、链路管理、帧定界、帧同步与透明传输、流量控制和差错控制

- 无确认的无连接服务，如以太网
- 有确认的无连接服务，如无线通信
- 有确认的有连接服务

组帧

1. 字符计数法![image-20200106235203191](E:\Onedrive\2019fall\计算机网络\review\images\image-20200106235203191.png)

2. 字符填充的首位定界符法

   即escape字符法

3. 比特填充的标志比特法

   `01111110`作为首尾标志，payload内每五个1后面补充一个0

### 差错控制（检错编码、纠错编码）

检错编码

1. 奇偶校验码

2. 循环冗余码(CRC)

   对于m bit 的帧，发送器生成一个r bit的帧检验序列(FCS)，计算CRC的步骤：

   1. 在帧的低位端加上r个0
   2. 利用模2除法（加法不进位，减法不借位，即异或运算）计算出的余数即为CRC
   3. 用步骤2计算出的CRC替代帧低位加上的r个0，同时传输m+r比特数据

   接收端对接收到的数据也使用模2除法，如果余数不为0，说明传输过程出现了差错

纠错编码

​	海明码：纠错d位，需要码距2d+1的编码方案；检错d位，只需要码距为d+1

### 流量控制、可靠传输与滑动窗口机制

流量控制 —— 滑动窗口协议

- 停止-等待协议（ 发送窗口=1，接收窗口=1）
- 后退N帧协议 （ 发送窗口=N，接收窗口=1） 窗口大小W， 1<W<=2^n-1
- 选择重传协议 （ 发送窗口>1，接收窗口>1）

可靠传输 —— 自动重传请求（ARQ）

​	数据链路层的可靠传输通常使用**确认**和**重传**两种机制来完成。确认是无数据的控制帧，也可将确认捎带在数据帧中

**信道效率**（信道利用率）：发送方在一个发送周期内，有效地发送数据所需要的时间占整个发送周期的比率

**信道吞吐率** ： 信道利用率 * 发送方的发送速率

### 停止－等待协议、后退N帧协议（GBN）、选择重传协议（SR）

- 停止-等待协议

- 后退N帧协议

  采用累积确认，发送窗口的尺寸应满足 1 ≤ W ≤ (2^n)-1

  其能达到的**信道利用率**= N*传输延迟 / (RTT + 一个发送帧的传输延迟 + 确认帧的传输延迟)

  能达到的**最大平均数据传输率** = min{ N*数据帧长/(RTT + 一个发送帧的传输延迟 + 确认帧的传输延迟)，信道带宽}

  **[注]**：计算信道利用率和数据传输率时，分子计算的是帧中数据部分的传输时间，分母计算的是总共的传输时间

- 选择重传协议

  接收端逐个确认正确接收的分组，ACK分组不再有累积确认的作用

  一般情况下，接受端窗口 = 发送端窗口 = 2^(n-1)

### 介质访问控制（MAC）协议（信道划分、随机访问、轮询访问，无冲突协议）

信道划分：信道划分均不会产生冲突

- 频分多路复用（FDM）将带宽分割成若干个不相交和子信道，每个子信道传输一种信号
- 时分多路复用（TDM）将物理信道按时间分为若干时间片，轮流给不同信号使用
- 波分多路复用（WDM）在一根光纤中传输多种不同波长(频率)的光信号
- 码分多路复用（CDM）靠不同的编码来区分各路原始信号
- 码分多址（CDMA）通过正交的码片来区分不同站点，信道上传输的是对所有码片求和的值

随机访问

​	

- 纯ALOHA：不检测直接发送，若无确认则等待重发

  ​	假定所有帧定长，传输一帧所用时间为T0

  ​	网络负载G：T0时间内所有站点发送成功和未成功而重传的帧数

  ​	**吞吐量** S = G*exp(-2G)	max≈0.184

- 时隙ALOHA：在纯ALOHA的基础上，只在时隙上升沿发送

  ​	**吞吐量** S = G*exp(-G) 	max≈0.368

- CSMA

  - 1-坚持：闲则发送，忙则持续监听
  - 非坚持：闲则发送，忙则随机等待一段时间后监听
  - p-坚持：闲则以p的概率发送，忙则等待随机一段时间后监听

- CSMA/CD：先听后发，边听边发，冲突停发，随机重发（用于总线形以太网，半双工方式下使用）

  ​	总线**单程**传播时延 τ ：**检测冲突的最短时间**：τ，**最长时间**：2τ(**争用期**)

  ​	`对于100Mb/s的以太网，其争用期为 (8b × 64) ÷ 100Mb/s = 5.12μs`

  ​	**二进制指数退避**：第k次冲突在`[0,2^(k-1) ]*争用期`内随机等待一个时间，k有最大值：**最大重传次数** 
      - k>16，直接丢弃 k>10，随机数区间固定在最大值1023上

  ​	**最小帧长**=2 × 总线传播时延 × 数据传输率

- CSMA/CA：预约信道、确认机制（ACK帧）、RTS/CTS帧（用于无线局域网）

  ​	RTS(请求发送)，CTS(清除发送)用于预约信道，发送方向无线站点发送RTS，站点返回CTS表示同意，同时告知其他发送方信道已被占用

  ​	并不能完全避免冲突，只是尽可能减少冲突

  ​	在本结点无冲突并不意味着目标结点也无冲突，反之同理

轮询访问：令牌传递协议-只有得到令牌的机器才能发送数据，所以不存在冲突（用于环形局域网）

- 用于负载重的网络环境下

### 局域网（以太网、IEEE802.11）

IEE802标准定义的局域网参考模型对应于OSI的数据链路层和物理层，并将数据链路层分为LLC子层和MAC子层。其中LLC协议相当于为网络层提供接口，提供无确认无连接、面向连接、带确认无连接、高速传送4种不同的服务类型。而事实上，由于以太网的垄断地位，很多网卡仅装有MAC协议，相当于仅提供无确认无连接的服务。

以太网的MAC帧

| (8字节)7B+1B  | 6字节    | 6字节  | 2(或4)字节         | 46-1500 | 4字节    |
| ------------- | -------- | ------ | ------------------ | ------- | -------- |
| 前导码+定界符 | 目的地址 | 源地址 | 类型（或类型/长度) | 数据    | FCS(CRC) |

以太网的最短MAC帧长为64B，CRC检查范围从目的地址段开始到数据段的末尾

100BASE-T 吉比特以太网 10吉比特以太网(全双工)

IEEE802.11数据帧

|         | 地址1（真实目的地址） | 地址2（真实源地址） | 地址3（转发的第三地址） |      |      |
| ------- | --------------------- | ------------------- | ----------------------- | ---- | ---- |
| From AP | 目的地址              | AP地址              | 源地址                  |      |      |
| To AP   | AP地址                | 源地址              | 目的地址                |      |      |

SLIP

PPP：字节填充法(异步线路)/比特填充(同步线路)+差错检验；只支持点对点、全双工；可连接不同的网络层协议

HDLC：比特填充；分为信息帧(数据信息或确认)、监督帧(流量控制、差错控制)、无编号帧（链路的建立、拆除）

### 网桥、局域网交换机的概念及其基本原理

- 网桥：把两个或多个以太网通过网桥连接起来变成一个网段
  - 透明网桥：自学习算法填写转发表，按转发表转发
  - 源路由网桥：先发送发现帧，按返回结果转发
- 交换机：实际就是一个多端口网桥
  - 直通式：帧在接收后只检查目的地址，几乎能马上转发出去
  - 存储转发：先读入cache检查CRC，检查无误再转发，否则丢弃

一块网卡发送信息时，只要有可能与另一块网卡冲突，可能冲突的网卡就构成冲突域；能接收到广播的所有网卡集合称为广播域。一般来说，一个网段就是一个冲突域；一个局域网就是一个广播域。网桥和交换机都能隔离冲突域，不能隔离广播域。

-网桥处理数据的对象是帧，工作在链路层；
   - 可分隔冲突域，不能分隔广播域
-中继器和放大器处理的对象是信号，工作在物理层。
   - 不能分隔广播域和冲突域

PS:路由器工作在网络层，可分割冲突域和广播域

中继器工作在物理层，用来连接两个速率相同且数据链路层协议也相同的网段，其功能是消除数字信号在基带传输中由于经过一长段电缆而造成的失真和衰减，使信号的波形和强度达到所需的要求；其原理是信号再生...
